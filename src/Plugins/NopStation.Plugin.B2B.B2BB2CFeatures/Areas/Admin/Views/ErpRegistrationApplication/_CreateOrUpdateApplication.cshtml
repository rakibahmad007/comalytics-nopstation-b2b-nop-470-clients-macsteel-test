@model ApplicationFormModel
@inject B2BB2CFeaturesSettings b2BB2CFeaturesSettings

<link rel="stylesheet" href="~/Plugins/NopStation.Plugin.B2B.B2BB2CFeatures/Content/css/googlemapstyle.css" />

<div asp-validation-summary="All"></div>
<input asp-for="Id" type="hidden" />

@{
    const string hideInfoBlockAttributeName = "ErpRegistrationApplicationPage.HideInfoBlock";
    const string hideAddressInfoBlockAttributeName = "ErpRegistrationApplicationPage.HideAddressInfoBlock";
    const string hideErpNopUsersBlockAttributeName = "ErpRegistrationApplicationPage.HideErpNopUsersBlock";
    const string hideErpShipToAddressesInfoBlockAttributeName = "ErpRegistrationApplicationPage.HideErpShipToAddressesInfoBlock";

    var customer = await workContext.GetCurrentCustomerAsync();

    var hideInfoBlock = await genericAttributeService.GetAttributeAsync<bool>(customer, hideInfoBlockAttributeName);
    var hideAddressInfoBlock = await genericAttributeService.GetAttributeAsync<bool>(customer, hideAddressInfoBlockAttributeName);
    var hideErpNopUsersBlock = await genericAttributeService.GetAttributeAsync<bool>(customer, hideErpNopUsersBlockAttributeName);
    var hideErpShipToAddressesInfoBlock = await genericAttributeService.GetAttributeAsync<bool>(customer, hideErpShipToAddressesInfoBlockAttributeName);

}

<section class="content">
    <div class="container-fluid">
        <div class="form-horizontal">
            <nop-cards id="customer-cards">
                <nop-card asp-name="registration-application-info" asp-icon="fas fa-info" asp-title="@T("B2BB2CFeatures.Admin.ErpRegistrationApplication.ApplicationForm.Info")" asp-hide-block-attribute-name="@hideInfoBlockAttributeName" asp-hide="@hideInfoBlock" asp-advanced="false">@await Html.PartialAsync("_CreateOrUpdateApplication.Info", Model)</nop-card>

                <nop-card asp-name="banking-details-info" asp-icon="fas fa-info" asp-title="@T("B2BB2CFeatures.Admin.ErpRegistrationApplication.ApplicationForm.Info.BankingDetails")" asp-hide-block-attribute-name="@hideAddressInfoBlockAttributeName" asp-hide="@hideAddressInfoBlock" asp-advanced="false">@await Html.PartialAsync("_CreateOrUpdateApplication.Info.BankingDetails", Model)</nop-card>

                <nop-card asp-name="physical-trading-address-info" asp-icon="fas fa-info" asp-title="@T("B2BB2CFeatures.Admin.ErpRegistrationApplication.ApplicationForm.Info.PhysicalTradingAddress")" asp-hide-block-attribute-name="@hideErpShipToAddressesInfoBlockAttributeName" asp-hide="@hideErpShipToAddressesInfoBlock" asp-advanced="false">@await Html.PartialAsync("_CreateOrUpdateApplication.Info.PhysicalTradingAddress", Model)</nop-card>

                <nop-card asp-name="tradeReferences-info" asp-icon="fas fa-users" asp-title="@T("B2BB2CFeatures.Admin.ErpRegistrationApplication.ApplicationForm.Info.TradeReferences")" asp-hide-block-attribute-name="@hideErpNopUsersBlockAttributeName" asp-hide="@hideErpNopUsersBlock" asp-advanced="false">@await Html.PartialAsync("_CreateOrUpdateApplication.Info.TradeReferences", Model)</nop-card>

                <nop-card asp-name="permises-info" asp-icon="fas fa-users" asp-title="@T("B2BB2CFeatures.Admin.ErpRegistrationApplication.ApplicationForm.Info.Permises")" asp-hide-block-attribute-name="@hideErpNopUsersBlockAttributeName" asp-hide="@hideErpNopUsersBlock" asp-advanced="false">@await Html.PartialAsync("_CreateOrUpdateApplication.Info.Permises", Model)</nop-card>
            </nop-cards>
        </div>
    </div>
</section>

<script>
    function initMapforRegisteredOfficeAddress1() {
        const addressInputs1 = document.querySelectorAll('.address-input1');

        const map1 = new google.maps.Map(document.getElementById("mapforRegisteredOfficeAddress1"), {
            center: { lat: @b2BB2CFeaturesSettings.Latitude, lng: @b2BB2CFeaturesSettings.Longitude },
            zoom: 8
        });

        // Initialize autocomplete for each address input
        addressInputs1.forEach((input, index) => {
            const autocomplete1 = new google.maps.places.Autocomplete(input);

            // Add listener for place changed event
            autocomplete1.addListener("place_changed", () => {
                const place1 = autocomplete1.getPlace();
                if (!place1.geometry || !place1.geometry.location) {
                    return;
                }

                // Update map position
                map1.setCenter(place1.geometry.location);
                map1.setZoom(15);

                // Add marker
                const marker1 = new google.maps.Marker({
                    position: place1.geometry.location,
                    map: map1
                });
            });
        });
    }

    function initMapforPhysicalTradingAddress1() {
        const addressInputs2 = document.querySelectorAll('.address-input2');

        const map2 = new google.maps.Map(document.getElementById("mapforPhysicalTradingAddress1"), {
            center: { lat: @b2BB2CFeaturesSettings.Latitude, lng: @b2BB2CFeaturesSettings.Longitude },
            zoom: 8
        });

        // Initialize autocomplete for each address input
        addressInputs2.forEach((input, index) => {
            const autocomplete2 = new google.maps.places.Autocomplete(input);

            // Add listener for place changed event
            autocomplete2.addListener("place_changed", () => {
                const place2 = autocomplete2.getPlace();
                if (!place2.geometry || !place2.geometry.location) {
                    return;
                }

                // Update map position
                map2.setCenter(place2.geometry.location);
                map2.setZoom(15);

                // Add marker
                const marker2 = new google.maps.Marker({
                    position: place2.geometry.location,
                    map: map2
                });
            });
        });
    }

    window.onload = function () {
        initMapforRegisteredOfficeAddress1();
        initMapforPhysicalTradingAddress1();
    };

</script>
<script src="https://maps.googleapis.com/maps/api/js?key=@b2BB2CFeaturesSettings.GoogleMapsApiKey&libraries=places&v=weekly" defer></script>