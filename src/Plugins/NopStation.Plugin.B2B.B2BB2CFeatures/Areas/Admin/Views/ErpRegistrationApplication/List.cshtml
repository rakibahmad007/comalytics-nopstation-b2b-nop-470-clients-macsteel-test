@using NopStation.Plugin.B2B.B2BB2CFeatures.Areas.Admin.Models;
@using Nop.Web.Areas.Admin.Models.Common;
@model NopStation.Plugin.B2B.B2BB2CFeatures.Areas.Admin.Models.ErpRegistrationApplication.ErpRegistrationApplicationSearchModel

@{
    Layout = "_AdminLayout";
    //title
    NopHtml.AddTitleParts(T("NopStation.Plugin.B2B.B2BB2CFeatures.SiteMapNode.Title.ErpRegistrationApplication").Text);
    ViewBag.PageTitle = T("NopStation.Plugin.B2B.B2BB2CFeatures.SiteMapNode.Title.ErpRegistrationApplication").Text;
    //active menu item (system name)
    NopHtml.SetActiveMenuItemSystemName(B2BB2CFeaturesDefaults.ErpRegistrationApplication_SiteMapNode_SystemName);
}

@{
    var customer = await workContext.GetCurrentCustomerAsync();

    const string hideSearchBlockAttributeName = "ErpRegistrationApplicationPage.HideSearchBlock";
    var hideSearchBlock = await genericAttributeService.GetAttributeAsync<bool>(await workContext.GetCurrentCustomerAsync(), hideSearchBlockAttributeName);

    const string hideErpAccountsBlockAttributeName = "ErpRegistrationApplicationPage.hideErpAccountsBlock";
    var hideErpAccountsBlock = await genericAttributeService.GetAttributeAsync<bool>(customer, hideErpAccountsBlockAttributeName);
}

<div class="content-header clearfix">
    <h1 class="float-left">
        @T("B2BB2CFeatures.ErpAccountCustomerRegistrationForm.PageHeader.ErpAccountCustomerRegistrationForms")
    </h1>
    <div class="float-right">
        <a asp-action="Create" asp-asp-controller="" class="btn btn-primary">
            <i class="fas fa-plus-square"></i>
            @T("Admin.Common.AddNew")
        </a>
    </div>
</div>

<section class="content">
    <div class="container-fluid">
        <div class="cards-group">
            <div class="card card-default card-search form-horizontal">
                <div class="card-body">
                    <div class="row search-row @(!hideSearchBlock ? "opened" : "")" data-hideAttribute="@hideSearchBlockAttributeName">
                        <div class="search-text">@T("B2BB2CFeatures.ErpAccountCustomerRegistrationForm.SearchErpAccountCustomerRegistrationForm")</div>
                        <div class="icon-search"><i class="fas fa-search" aria-hidden="true"></i></div>
                        <div class="icon-collapse"><i class="far fa-angle-@(!hideSearchBlock ? "up" : "down")" aria-hidden="true"></i></div>
                    </div>
                    <div class="search-body @(hideSearchBlock ? "closed" : "")">
                        <div class="form-group row">
                            <div class="col-md-5">
                                <div class="form-group row">
                                    <div class="col-md-4">
                                        <nop-label asp-for="FullRegisteredName" />
                                    </div>
                                    <div class="col-md-8">
                                        <nop-editor asp-for="FullRegisteredName" />
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <div class="col-md-4">
                                        <nop-label asp-for="RegistrationNumber" />
                                    </div>
                                    <div class="col-md-8">
                                        <nop-editor asp-for="RegistrationNumber" />
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <div class="col-md-4">
                                        <nop-label asp-for="AccountsEmail" />
                                    </div>
                                    <div class="col-md-8">
                                        <nop-editor asp-for="AccountsEmail" />
                                    </div>
                                </div>
                                @* <div class="form-group row">
                                <div class="col-md-4">
                                <nop-label asp-for="ShowInActive" />
                                </div>
                                <div class="col-md-8">
                                <nop-select asp-for="ShowInActive" asp-items="Model.ShowInActiveOption" />
                                </div>
                                </div> *@
                            </div>
                            <div class="col-md-7">
                                <div class="form-group row">
                                    <div class="col-md-4">
                                        <nop-label asp-for="FromDate" />
                                    </div>
                                    <div class="col-md-8">
                                        <nop-editor asp-for="FromDate" />
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <div class="col-md-4">
                                        <nop-label asp-for="ToDate" />
                                    </div>
                                    <div class="col-md-8">
                                        <nop-editor asp-for="ToDate" />
                                    </div>
                                </div>
                                <div class="form-group row">
                                    <div class="col-md-4">
                                        <nop-label asp-for="ShowIsApproved" />
                                    </div>
                                    <div class="col-md-8">
                                        <nop-select asp-for="ShowIsApproved" asp-items="Model.ShowIsApprovedOption" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="text-center col-md-12">
                                <button type="button" id="search-erpRegistrationApplications" class="btn btn-primary btn-search">
                                    <i class="fas fa-search"></i>
                                    @T("Admin.Common.Search")
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <nop-card asp-name="ErpRegistrationApplication" asp-icon="fas fa-users" asp-title="@T("B2BB2CFeatures.ErpAccountCustomerRegistrationForm.Card.ErpAccountCustomerRegistrationForms")" asp-hide-block-attribute-name="@hideErpAccountsBlockAttributeName" asp-hide="@hideErpAccountsBlock" asp-advanced="true">
                <div class="card-body">
                    <div class="card card-default">
                        <div class="card-body">
                            @await Html.PartialAsync("Table", new DataTablesModel
                       {
                           Name = "ErpAccounts-grid",
                           UrlRead = new DataUrl("List", "", null),
                           UrlDelete = new DataUrl("Delete", "ErpRegistrationApplication", null),
                           SearchButtonId = "search-erpRegistrationApplications",
                           Length = Model.PageSize,
                           LengthMenu = Model.AvailablePageSizes,
                           Filters = new List<FilterParameter>
                            {
                            new FilterParameter(nameof(Model.FormId), typeof(string)),
                            new FilterParameter(nameof(Model.FullRegisteredName), typeof(string)),
                            new FilterParameter(nameof(Model.RegistrationNumber), typeof(string)),
                            new FilterParameter(nameof(Model.AccountsEmail), typeof(string)),
                            new FilterParameter(nameof(Model.FromDate), typeof(string)),
                            new FilterParameter(nameof(Model.ToDate), typeof(string)),
                            new FilterParameter(nameof(Model.ShowIsApproved), typeof(string)),
                            //new FilterParameter(nameof(Model.ErpAccountStatusTypeId), typeof(string))
                            },
                           ColumnCollection = new List<ColumnProperty>
                            {
                            new ColumnProperty(nameof(ApplicationFormModel.FullRegisteredName))
                            {
                            Title = T("B2BB2CFeatures.Admin.ErpRegistrationApplication.ApplicationForm.Fields.FullRegisteredName").Text,
                            Width = "150",
                            //Render = new RenderLink(new DataUrl("~/Admin/ErpSalesOrg/ErpSalesOrgEdit/", nameof(ErpAccountModel.ErpSalesOrgId))),
                            },
                            new ColumnProperty(nameof(ApplicationFormModel.RegistrationNumber))
                            {
                            Title = T("B2BB2CFeatures.Admin.ErpRegistrationApplication.ApplicationForm.Fields.RegistrationNumber").Text,
                            Width = "150",
                            },
                            new ColumnProperty(nameof(ApplicationFormModel.VatNumber))
                            {
                            Title = T("B2BB2CFeatures.Admin.ErpRegistrationApplication.ApplicationForm.Fields.VatNumber").Text,
                            Width = "100",
                            },
                            new ColumnProperty(nameof(ApplicationFormModel.TelephoneNumber1))
                            {
                            Title = T("B2BB2CFeatures.Admin.ErpRegistrationApplication.ApplicationForm.Fields.TelephoneNumber1").Text,
                            Width = "100",
                            },
                            new ColumnProperty(nameof(ApplicationFormModel.TelephoneNumber2))
                            {
                            Title = T("B2BB2CFeatures.Admin.ErpRegistrationApplication.ApplicationForm.Fields.TelephoneNumber2").Text,
                            Width = "100",
                            //Render = new RenderCustom("ShowEmail"),
                            },
                            new ColumnProperty(nameof(ApplicationFormModel.TelefaxNumber))
                            {
                            Title = T("B2BB2CFeatures.Admin.ErpRegistrationApplication.ApplicationForm.Fields.TelefaxNumber").Text,
                            Width = "100"
                            },
                            new ColumnProperty(nameof(ApplicationFormModel.AccountsContactPersonNameSurname))
                            {
                            Title = T("B2BB2CFeatures.Admin.ErpRegistrationApplication.ApplicationForm.Fields.AccountsContactPersonNameSurname").Text,
                            Width = "100",
                            //ClassName = "text-right"
                            },
                            new ColumnProperty(nameof(ApplicationFormModel.AccountsEmail))
                            {
                            Title = T("B2BB2CFeatures.Admin.ErpRegistrationApplication.ApplicationForm.Fields.AccountsEmail").Text,
                            Width = "100",
                            //ClassName = "text-right"
                            },
                            new ColumnProperty(nameof(ApplicationFormModel.AccountsTelephoneNumber))
                            {
                            Title = T("B2BB2CFeatures.Admin.ErpRegistrationApplication.ApplicationForm.Fields.AccountsTelephoneNumber").Text,
                            Width = "100",
                            },
                            new ColumnProperty(nameof(ApplicationFormModel.AccountsCellphoneNumber))
                            {
                            Title = T("B2BB2CFeatures.Admin.ErpRegistrationApplication.ApplicationForm.Fields.AccountsCellphoneNumber").Text,
                            Width = "100",
                            },
                            new ColumnProperty(nameof(ApplicationFormModel.BuyerContactPersonNameSurname))
                            {
                            Title = T("B2BB2CFeatures.Admin.ErpRegistrationApplication.ApplicationForm.Fields.BuyerContactPersonNameSurname").Text,
                            Width = "100",
                            },
                            new ColumnProperty(nameof(ApplicationFormModel.BuyerEmail))
                            {
                            Title = T("B2BB2CFeatures.Admin.ErpRegistrationApplication.ApplicationForm.Fields.BuyerEmail").Text,
                            Width = "150",
                            },
                            new ColumnProperty(nameof(ApplicationFormModel.NatureOfBusiness))
                            {
                            Title = T("B2BB2CFeatures.Admin.ErpRegistrationApplication.ApplicationForm.Fields.NatureOfBusiness").Text,
                            Width = "100",
                            },
                            // new ColumnProperty(nameof(ApplicationFormModel.RegisteredOfficeAddress1))
                            // {
                            // Title = T("B2BB2CFeatures.Admin.ErpRegistrationApplication.ApplicationForm.Fields.RegisteredOfficeAddress1").Text,
                            // Width = "150",
                            // },
                            new ColumnProperty(nameof(ApplicationFormModel.EstimatePurchasesPerMonthZAR))
                            {
                            Title = T("B2BB2CFeatures.Admin.ErpRegistrationApplication.ApplicationForm.Fields.EstimatePurchasesPerMonthZAR").Text,
                            Width = "150",
                            ClassName = "text-right"
                            },
                            new ColumnProperty(nameof(ApplicationFormModel.CreditLimitRequired))
                            {
                            Title = T("B2BB2CFeatures.Admin.ErpRegistrationApplication.ApplicationForm.Fields.CreditLimitRequired").Text,
                            Width = "50",
                            },
                            // new ColumnProperty(nameof(ApplicationFormModel.IsActive))
                            // {
                            //     Title = T("Plugin.Misc.NopStation.ERPIntegrationCore.ErpAccount.Field.IsActive").Text,
                            //     Width = "60",
                            //     ClassName = NopColumnClassDefaults.CenterAll,
                            //     Render = new RenderBoolean(),
                            // },
                            new ColumnProperty(nameof(ApplicationFormModel.CreatedOn))
                            {
                            Title = T("B2BB2CFeatures.Admin.ErpRegistrationApplication.ApplicationForm.Fields.CreatedOnUtc").Text,
                            Width = "150",
                            Render = new RenderDate()
                            },
                            new ColumnProperty(nameof(ApplicationFormModel.Id))
                            {
                            Title = T("Admin.Common.Edit").Text,
                            Width = "80",
                            ClassName = NopColumnClassDefaults.Button,
                            Render = new RenderButtonEdit(new DataUrl("~/Admin/ErpRegistrationApplication/ApplicationEdit/"))
                            },
                            new ColumnProperty(nameof(ApplicationFormModel.Id))
                            {
                            Title = T("Admin.Common.Delete").Text,
                            Width = "80",
                            ClassName =  NopColumnClassDefaults.Button,
                            Render = new RenderButtonRemove(T("Admin.Common.Delete").Text),
                            Visible = false
                            }
                            }
                       })
                        </div>
                    </div>
                </div>
            </nop-card>
        </div>
    </div>
</section>

<script>
    function ShowEmail(data, type, row, meta) {
        return '<span>' + row.BillingAddress.Email + '</span >';
    }
</script>

<style>
    .button-column {
        text-align: center !important;
    }
</style>